__license__   = 'GPL v3'
__author__    = 'Lorenzo Vigentini, based on Darko Miletic, Gabriele Marini'
__copyright__ = '2009-2011, Darko Miletic <darko.miletic at gmail.com>, Lorenzo Vigentini <l.vigentini at gmail.com>'
description   = 'Italian daily newspaper - v1.01 (04, January 2010); 16.05.2010 new version'

'''
http://www.repubblica.it/
'''

import re
from calibre.web.feeds.news import BasicNewsRecipe

class LaRepubblica(BasicNewsRecipe):
    title                = 'La Repubblica'
    __author__           = 'Lorenzo Vigentini, Gabriele Marini, Darko Miletic'
    description          = 'il quotidiano online con tutte le notizie in tempo reale. News e ultime notizie. Tutti i settori: politica, cronaca, economia, sport, esteri, scienza, tecnologia, internet, spettacoli, musica, cultura, arte, mostre, libri, dvd, vhs, concerti, cinema, attori, attrici, recensioni, chat, cucina, mappe. Le citta di Repubblica: Roma, Milano, Bologna, Firenze, Palermo, Napoli, Bari, Torino.'
    masthead_url         = 'http://www.repubblica.it/static/images/homepage/2010/la-repubblica-logo-home-payoff.png'
    publisher            = 'Gruppo editoriale L\'Espresso'
    category             = 'News, politics, culture, economy, general interest'
    language             = 'it'
    timefmt              = '[%a, %d %b, %Y]'
    oldest_article       = 5
    encoding             = 'utf8'
    use_embedded_content = False
    #recursion           = 10
    no_stylesheets       = True
    extra_css            = """
                              img{display: block}
                           """

    preprocess_regexps = [
        (re.compile(r'.*?<head>', re.DOTALL|re.IGNORECASE), lambda match: '<head>'),
        (re.compile(r'<head>.*?<title>', re.DOTALL|re.IGNORECASE), lambda match: '<head><title>'),
        (re.compile(r'</title>.*?</head>', re.DOTALL|re.IGNORECASE), lambda match: '</title></head>')
    ]
    
    def get_article_url(self, article):
        link = article.get('id', article.get('guid', None))
        if link is None:
            return article
        return link
    
    keep_only_tags     = [
                          dict(attrs={'class':'articolo'}),
                          dict(attrs={'class':'body-text'}),
                          dict(name='p', attrs={'class':'disclaimer clearfix'}),
                          dict(attrs={'id':'contA'})
                         ]


    remove_tags        = [
                            dict(name=['object','link','meta']),
                            dict(name='span',attrs={'class':'linkindice'}),
                            dict(name='div', attrs={'class':'bottom-mobile'}),
                            dict(name='div', attrs={'id':['rssdiv','blocco']}),
                            dict(name='div', attrs={'class':'utility'}),
                            dict(name='div', attrs={'class':'generalbox'}),
                            dict(name='ul', attrs={'id':'hystory'})
                         ]

    feeds          = [
                       (u'Rilievo', u'http://www.repubblica.it/rss/homepage/rss2.0.xml'),
                       (u'Cronaca', u'http://www.repubblica.it/rss/cronaca/rss2.0.xml'),
                       (u'Esteri', u'http://www.repubblica.it/rss/esteri/rss2.0.xml'),
                       (u'Economia', u'http://www.repubblica.it/rss/economia/rss2.0.xml'),
                       (u'Politica', u'http://www.repubblica.it/rss/politica/rss2.0.xml'),
                       (u'Scienze', u'http://www.repubblica.it/rss/scienze/rss2.0.xml'),
                       (u'Tecnologia', u'http://www.repubblica.it/rss/tecnologia/rss2.0.xml'),
                       (u'Scuola e Universita', u'http://www.repubblica.it/rss/scuola_e_universita/rss2.0.xml'),
                       (u'Ambiente', u'http://www.repubblica.it/rss/ambiente/rss2.0.xml'),
                       (u'Cultura', u'http://www.repubblica.it/rss/spettacoli_e_cultura/rss2.0.xml'),
                       (u'Persone', u'http://www.repubblica.it/rss/persone/rss2.0.xml'),
                       (u'Sport', u'http://www.repubblica.it/rss/sport/rss2.0.xml'),
                       (u'Calcio', u'http://www.repubblica.it/rss/sport/calcio/rss2.0.xml'),
                       (u'Motori', u'http://www.repubblica.it/rss/motori/rss2.0.xml'),
                       (u'Edizione Roma', u'http://roma.repubblica.it/rss/rss2.0.xml'),
                       (u'Edizione Torino', u'http://torino.repubblica.it/rss/rss2.0.xml'),
                       (u'Edizione Milano', u'feed://milano.repubblica.it/rss/rss2.0.xml'),
                       (u'Edizione Napoli', u'feed://napoli.repubblica.it/rss/rss2.0.xml'),
                       (u'Edizione Palermo', u'feed://palermo.repubblica.it/rss/rss2.0.xml')
                      ]

