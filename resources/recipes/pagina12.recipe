
__license__   = 'GPL v3'
__copyright__ = '2008-2010, Darko Miletic <darko.miletic at gmail.com>'
'''
pagina12.com.ar
'''

import re, time
from calibre import strftime
from calibre.web.feeds.news import BasicNewsRecipe
from calibre.ebooks.BeautifulSoup import BeautifulSoup, NavigableString, CData, Tag

class Pagina12(BasicNewsRecipe):
    title                 = 'Pagina - 12'
    __author__            = 'Darko Miletic'
    description           = 'Noticias de Argentina y el resto del mundo'
    publisher             = 'La Pagina S.A.'
    category              = 'news, politics, Argentina'
    oldest_article        = 2
    max_articles_per_feed = 100
    no_stylesheets        = True
    encoding              = 'cp1252'
    use_embedded_content  = False
    language              = 'es'
    remove_empty_feeds    = True
    masthead_url          = 'http://www.pagina12.com.ar/commons/imgs/logo-home.gif'
    extra_css             = ' body{font-family: Arial,Helvetica,sans-serif } h2{color: #028CCD} img{margin-bottom: 0.4em} .epigrafe{font-size: x-small; background-color: #EBEAE5; color: #565144 } .intro{font-size: 1.1em} '

    conversion_options = {
                          'comment'   : description
                        , 'tags'      : category
                        , 'publisher' : publisher
                        , 'language'  : language
                        }

    remove_tags = [dict(name='div', attrs={'id':['volver','logo','logo_suple','fin','permalink']})]
    

    feeds = [
              (u'Edicion impresa', u'http://www.pagina12.com.ar/diario/rss/principal.xml'   )
             ,(u'Espectaculos'   , u'http://www.pagina12.com.ar/diario/rss/espectaculos.xml')
             ,(u'Radar'          , u'http://www.pagina12.com.ar/diario/rss/radar.xml'       )
             ,(u'Radar libros'   , u'http://www.pagina12.com.ar/diario/rss/libros.xml'      )
             ,(u'Cash'           , u'http://www.pagina12.com.ar/diario/rss/cash.xml'        )
             ,(u'Turismo'        , u'http://www.pagina12.com.ar/diario/rss/turismo.xml'     )
             ,(u'Libero'         , u'http://www.pagina12.com.ar/diario/rss/libero.xml'      )
             ,(u'NO'             , u'http://www.pagina12.com.ar/diario/rss/no.xml'          )
             ,(u'Las/12'         , u'http://www.pagina12.com.ar/diario/rss/las12.xml'       )
             ,(u'Soy'            , u'http://www.pagina12.com.ar/diario/rss/soy.xml'         )
             ,(u'M2'             , u'http://www.pagina12.com.ar/diario/rss/futuro.xml'      )
            ]

    def print_version(self, url):
        return url.replace('http://www.pagina12.com.ar/','http://www.pagina12.com.ar/imprimir/')

    def get_cover_url(self):
        rawc = self.index_to_soup('http://www.pagina12.com.ar/diario/principal/diario/index.html',True)
        rawc2 = re.sub(r'PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN','PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"',rawc)
        soup = BeautifulSoup(rawc2,fromEncoding=self.encoding,smartQuotesTo=None)
        for image in soup.findAll('img',alt=True):
           if image['alt'].startswith('Tapa de la fecha'):
              return image['src']
        return None
        