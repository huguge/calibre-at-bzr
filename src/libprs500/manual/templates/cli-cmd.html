<?python
  from genshi import HTML
  title = cmd
  usage = [i for i in parser.usage.replace('%prog', cmd).splitlines(True) if i]
  cmdline = usage[0]
  usage = usage[1:]
  usage = [i.replace(cmd, '<span class="cmd">%s</span>'%cmd) for i in usage]
  groups = [(None, None, parser.option_list)]
  for grp in parser.option_groups:
    groups.append((grp.title, grp.description, grp.option_list))
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
      xml:lang="en"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:py="http://genshi.edgewall.org/" 
       
>
    <xi:include href="layout.html" />
      
    <head>
      <title>${cmd}</title>
    </head>
      
    <body>
        <pre class="runcmd">${cmdline}</pre>
        <p>
            <py:for each="line in usage">${HTML(line)}<br /></py:for>
        </p>
        <h2 class="sectionHeading">[options]</h2>
        <table class="option_table">
            <py:for each="title, desc, options in groups">
                <tr py:if="title is not None"><th colspan="2"><h3 class="subsectionHeading">${title}</h3></th></tr>
                <tr py:if="desc is not None"><td colspan="2">${desc}<br />&nbsp;</td></tr>
                <tr py:for="option in options">
                    <td class="option" py:with="short = ', '.join(option._short_opts)">
                        ${option.get_opt_string()}<br />${short}
                    </td>
                    <td py:with="help = option.help if option.help else ''">${help}</td>
                </tr>
            </py:for>            
        </table>
      
    </body>
      
</html>